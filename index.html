<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panneau de s√©curit√©</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/qrcode-styling@1.5.0/lib/umd.min.js"></script>
</head>
<body>
  <!-- Connexion -->
  <div id="loginPanel" class="card">
    <h2>Connexion</h2>
    <form id="loginForm">
      <label>Nom d‚Äôutilisateur</label>
      <input type="text" id="username" required />
      <label>Mot de passe</label>
      <input type="password" id="password" required />
      <button type="submit">Se connecter</button>
    </form>
  </div>

  <!-- Tableau de bord admin -->
  <div id="adminPanel" class="hidden">
    <h2>Tableau de bord Admin</h2>
    <p>Gestion des comptes utilisateurs</p>
    <!-- ‚Ä¶ ton code admin original inchang√© ‚Ä¶ -->
  </div>

  <!-- Tableau de bord utilisateur -->
  <div id="userPanel" class="hidden">
    <h2>Tableau de bord Utilisateur</h2>
    <p>Bienvenue utilisateur</p>
    <!-- ‚Ä¶ ton code utilisateur original inchang√© ‚Ä¶ -->
  </div>

  <!-- Formulaire d‚Äôinvit√© -->
  <div id="invitePanel" class="hidden">
    <div class="card">
      <h3>Formulaire d‚Äôenregistrement des invit√©s</h3>
      <form id="guestForm">
        <label>Appartement</label>
        <input type="text" id="apartment" required />
        <label>B√¢timent</label>
        <input type="text" id="building" required />
        <label>Date d'arriv√©e</label>
        <input type="date" id="arrivalDate" required />
        <label>Nombre d'invit√©s</label>
        <input type="number" id="guestCount" required min="1" />
        <label>Nom et pr√©nom</label>
        <input type="text" id="fullname" required />
        <label>Passeport/Carte Nationale</label>
        <input type="text" id="idNumber" required />
        <button type="submit">Enregistrer</button>
      </form>
      <p id="successMessage" class="banner ok hidden">‚úÖ Informations enregistr√©es avec succ√®s !</p>

      <div id="qrcodeContainer" class="hidden" style="margin-top:20px; text-align:center;">
        <p class="note">
          ‚ö†Ô∏è Seules les voyageurs qui sont enregistr√©s dans la r√©servation et dans ce formulaire seront autoris√©s.
          Merci de pr√©senter ce code aux agents de s√©curit√©.
        </p>
        <h4>Votre QR Code</h4>
        <div id="qrcode"></div>
        <button id="downloadBtn">T√©l√©charger le QR Code</button>
      </div>
    </div>
  </div>

  <script>
    // === Gestion connexion (inchang√©e) ===
    const loginForm = document.getElementById("loginForm");
    loginForm.addEventListener("submit", function(e){
      e.preventDefault();
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if(user === "admin" && pass === "admin"){
        document.getElementById("loginPanel").classList.add("hidden");
        document.getElementById("adminPanel").classList.remove("hidden");
      } else {
        document.getElementById("loginPanel").classList.add("hidden");
        document.getElementById("userPanel").classList.remove("hidden");
      }
    });

    // === IndexedDB / logique admin-user (inchang√©e) ===
    // ‚Ä¶ ton code original pour la gestion de la DB reste ici ‚Ä¶

    // === QR Code Styling pour formulaire invit√© ===
    const qrCode = new QRCodeStyling({
      width: 200,
      height: 200,
      margin: 10,
      qrOptions: { errorCorrectionLevel: "H" },
      dotsOptions: { color: "#174ea6", type: "rounded" },
      backgroundOptions: { color: "#ffffff" }
    });

    document.getElementById("guestForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const apartment = document.getElementById("apartment").value.trim();
      const building = document.getElementById("building").value.trim();
      const arrivalDate = document.getElementById("arrivalDate").value;
      const guestCount = document.getElementById("guestCount").value.trim();
      const fullname = document.getElementById("fullname").value.trim();
      const idNumber = document.getElementById("idNumber").value.trim();

      if (!apartment || !building || !arrivalDate || !guestCount || !fullname || !idNumber) {
        alert("Veuillez remplir tous les champs obligatoires !");
        return;
      }

      const message =
        `üìå Appartement: ${apartment}\n` +
        `üè¢ B√¢timent: ${building}\n` +
        `üìÖ Date d'arriv√©e: ${arrivalDate}\n` +
        `üë• Nombre d'invit√©s: ${guestCount}\n` +
        `üôç Nom & Pr√©nom: ${fullname}\n` +
        `üÜî ID: ${idNumber}`;

      qrCode.update({ data: message });
      document.getElementById("qrcode").innerHTML = "";
      qrCode.append(document.getElementById("qrcode"));
      document.getElementById("successMessage").classList.remove("hidden");
      document.getElementById("qrcodeContainer").classList.remove("hidden");
      document.getElementById("guestForm").reset();
    });

    document.getElementById("downloadBtn").addEventListener("click", () => {
      qrCode.download({ name: "Guest_QR_Code", extension: "png" });
    });
  </script>
</body>
</html>