<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Liste des enregistrements</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

<div class="max-w-5xl mx-auto bg-white shadow-xl rounded-2xl p-8">
  <h1 class="text-2xl font-bold mb-6 text-center text-gray-800">Liste des invités enregistrés</h1>

  <table class="w-full table-auto border border-gray-300 rounded-xl overflow-hidden">
    <thead class="bg-blue-600 text-white">
      <tr>
        <th class="px-4 py-2">Nom & Prénom</th>
        <th class="px-4 py-2">Appartement</th>
        <th class="px-4 py-2">Bâtiment</th>
        <th class="px-4 py-2">Date d'arrivée</th>
        <th class="px-4 py-2">Nombre de personnes</th>
        <th class="px-4 py-2">Actions</th>
      </tr>
    </thead>
    <tbody id="guestTable" class="text-center"></tbody>
  </table>
</div>

<script>
  // Exemple de données déjà enregistrées
  const guests = [
    {
      fullname: "Yeye (Yeye)",
      apartment: 6,
      building: 10,
      arrival: "2025-08-15",
      count: 1,
      sent: false
    },
    {
      fullname: "Ali (Ali)",
      apartment: 6,
      building: 10,
      arrival: "2025-08-16",
      count: 2,
      sent: false
    }
  ];

  function generateGuestLink(guest) {
    // Ici on ouvre le formulaire premier code dans une nouvelle fenêtre
    const url = `premier_code.html?apartment=${guest.apartment}&building=${guest.building}`;
    window.open(url, "_blank", "width=600,height=700");
  }

  function sendWhatsApp(index) {
    const guest = guests[index];
    const message = `
Salam :
Arrivée: ${guest.arrival}
Appartement: ${guest.apartment}
Imm: ${guest.building}
Nombre de personnes: ${guest.count} personnes
Réservation au nom de:
${guest.fullname}

Autres personnes:
0

NB : Svp pas d'autres personnes autorisées seul Les personnes figurent dans la réservation.

Merci
------------------------------------------
السلام عليكم:
الوصول: ${guest.arrival}
الشقة: ${guest.apartment}
رقم العمارة: ${guest.building}
عدد الأشخاص: ${guest.count} أشخاص
الحجز باسم: ${guest.fullname}

أشخاص آخرون:
0

ملاحظة: الرجاء عدم السماح لأي أشخاص آخرين، فقط الأشخاص المذكورين في الحجز.

شكرًا.
    `;
    const encodedMessage = encodeURIComponent(message);
    const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
    window.open(whatsappUrl, "_blank");
    guests[index].sent = true;
    renderTable();
  }

  function renderTable() {
    const tbody = document.getElementById('guestTable');
    tbody.innerHTML = '';
    guests.forEach((guest, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="px-4 py-2 ${guest.sent ? 'line-through' : ''}">${guest.fullname}</td>
        <td class="px-4 py-2">${guest.apartment}</td>
        <td class="px-4 py-2">${guest.building}</td>
        <td class="px-4 py-2">${guest.arrival}</td>
        <td class="px-4 py-2">${guest.count}</td>
        <td class="px-4 py-2 space-x-2">
          <button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition" onclick="generateGuestLink(guests[${index}])">Générer lien</button>
          <button class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition" onclick="sendWhatsApp(${index})">Envoyer WhatsApp</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  renderTable();
</script>

</body>
</html>