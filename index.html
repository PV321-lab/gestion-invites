Parfait, je comprends exactement ce que tu veux :

Pour chaque invité (y compris le responsable), il faut saisir nom + prénom + document dans des champs individuels.

Le nombre d’invités détermine combien de champs supplémentaires apparaissent.

Lors de l’enregistrement, chaque enregistrement doit inclure tous les invités, pas seulement le responsable.

Le QR code doit être généré pour toutes ces informations.

Le tableau utilisateur doit afficher correctement tous les invités et leurs documents.

Voici le code complet corrigé pour gérer cela :

<!DOCTYPE html> <html lang="fr"> <head> <meta charset="UTF-8"> <title>Enregistrement des invités</title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <style> body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; } h2 { text-align: center; } .card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); margin-bottom: 20px; } label { font-weight: bold; display: block; margin-top: 10px; } input { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 6px; } button { margin-top: 15px; padding: 10px; border: none; border-radius: 8px; background: #007bff; color: #fff; font-size: 16px; cursor: pointer; } button:hover { background: #0056b3; } table { width: 100%; border-collapse: collapse; margin-top: 20px; } th, td { border: 1px solid #ccc; padding: 8px; text-align: center; } th { background: #e9ecef; } #qrcode { text-align: center; margin-top: 20px; } .message { text-align: center; font-weight: bold; color: green; margin-top: 15px; } .error { color: red; text-align: center; margin-top: 10px; } </style> </head> <body> <h2>Enregistrement des invités</h2> <div id="login" class="card"> <label>Appartement</label> <input type="text" id="loginAppart"> <label>Bâtiment</label> <input type="text" id="loginBat"> <label>Mot de passe</label> <input type="password" id="loginPass"> <button onclick="connexion()">Se connecter</button> <div id="loginError" class="error"></div> </div> <div id="app" style="display:none;"> <div id="userPanel" class="card" style="display:none;"> <h3>Nouvel enregistrement</h3> <label>Appartement</label> <input type="text" id="infoAppart" disabled> <label>Bâtiment</label> <input type="text" id="infoBat" disabled> <label>Nombre de personnes (incluant responsable)</label> <input type="number" id="nbPers" min="1" value="1" onchange="genererChamps()"> <div id="personnes"></div> <label>Date d’arrivée</label> <input type="date" id="dateArrivee"> <button onclick="enregistrer()">Enregistrer et générer QR code</button> <div id="qrcode"></div> <table id="userTable"></table> </div> <div id="adminPanel" class="card" style="display:none;"> <h3>Gestion des utilisateurs</h3> <label>Appartement</label> <input type="text" id="newAppart"> <label>Bâtiment</label> <input type="text" id="newBat"> <label>Mot de passe</label> <input type="password" id="newPass"> <button onclick="ajouterUtilisateur()">Ajouter utilisateur</button> <table id="adminTable"></table> </div> </div> <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script> <script> let users = JSON.parse(localStorage.getItem("users")) || [ {appart:"6", bat:"6", pass:"12"}, {appart:"admin", bat:"admin", pass:"admin"} ]; let records = JSON.parse(localStorage.getItem("records")) || []; let currentUser = null; let sessionTimeout; function connexion() { const a=document.getElementById("loginAppart").value.trim(); const b=document.getElementById("loginBat").value.trim(); const p=document.getElementById("loginPass").value.trim(); const u=users.find(x=>x.appart===a && x.bat===b && x.pass===p); if(!u){document.getElementById("loginError").innerText="⚠️ Identifiants incorrects"; return;} currentUser=u; document.getElementById("login").style.display="none"; document.getElementById("app").style.display="block"; if(a==="admin" && b==="admin"){document.getElementById("adminPanel").style.display="block"; refreshAdmin();} else{document.getElementById("userPanel").style.display="block"; document.getElementById("infoAppart").value=u.appart; document.getElementById("infoBat").value=u.bat; genererChamps(); refreshUser();} clearTimeout(sessionTimeout); sessionTimeout=setTimeout(deconnexion,30*60*1000); } function deconnexion() {currentUser=null; document.getElementById("app").style.display="none"; document.getElementById("login").style.display="block"; document.getElementById("loginError").innerText="";} function genererChamps() { const nb=parseInt(document.getElementById("nbPers").value); const cont=document.getElementById("personnes"); cont.innerHTML=""; for(let i=1;i<=nb;i++){ const nom=document.createElement("input"); nom.placeholder="Nom & Prénom de la personne "+i; nom.id="persNom"+i; const doc=document.createElement("input"); doc.placeholder="Document (Passeport ou CNI) de la personne "+i; doc.id="persDoc"+i; cont.appendChild(nom); cont.appendChild(doc); } } function enregistrer() { const nb=parseInt(document.getElementById("nbPers").value); const date=document.getElementById("dateArrivee").value; if(!date||nb<1){alert("⚠️ Tous les champs sont obligatoires");return;} let personnes=[]; for(let i=1;i<=nb;i++){ const nom=document.getElementById("persNom"+i).value.trim(); const doc=document.getElementById("persDoc"+i).value.trim(); if(!nom||!doc){alert("⚠️ Remplissez tous les noms et documents"); return;} personnes.push({nom, doc}); } const rec={appart:currentUser.appart, bat:currentUser.bat, date, personnes, sent:false}; const params=new URLSearchParams({appart:rec.appart, bat:rec.bat, date:rec.date, personnes:rec.personnes.map(p=>p.nom+"|"+p.doc).join(";")}); rec.link="?"+params.toString(); records.push(rec); localStorage.setItem("records",JSON.stringify(records)); refreshUser(); generateQRCode(rec); alert("✅ Enregistrement ajouté !"); } function refreshUser() { const table=document.getElementById("userTable"); table.innerHTML="<tr><th>Date</th><th>Personnes</th><th>Lien</th><th>WhatsApp</th><th>Status</th></tr>"; records.filter(r=>r.appart===currentUser.appart && r.bat===currentUser.bat).forEach((r,i)=>{ const row=table.insertRow(); row.insertCell().innerText=r.date; row.insertCell().innerText=r.personnes.map(p=>p.nom+" ("+p.doc+")").join("\n"); row.insertCell().innerHTML='<a href="'+r.link+'">Lien</a>'; row.insertCell().innerHTML='<button onclick="envoyerWhatsApp('+i+')">Envoyer</button>'; row.insertCell().innerText=r.sent?"✅ Envoyé":"❌ Non envoyé"; }); } function generateQRCode(rec){ document.getElementById("qrcode").innerHTML=""; new QRCode(document.getElementById("qrcode"),{ text:JSON.stringify(rec), width:200, height:200 }); } function refreshAdmin() { const table=document.getElementById("adminTable"); table.innerHTML="<tr><th>Appartement</th><th>Bâtiment</th><th>Date</th><th>Personnes</th></tr>"; records.forEach(r=>{ const row=table.insertRow(); row.insertCell().innerText=r.appart; row.insertCell().innerText=r.bat; row.insertCell().innerText=r.date; row.insertCell().innerText=r.personnes.map(p=>p.nom+" ("+p.doc+")").join("\n"); }); } function ajouterUtilisateur() { const a=document.getElementById("newAppart").value.trim(); const b=document.getElementById("newBat").value.trim(); const p=document.getElementById("newPass").value.trim(); if(!a||!b||!p){alert("⚠️ Champs obligatoires");return;} users.push({appart:a, bat:b, pass:p}); localStorage.setItem("users",JSON.stringify(users)); alert("✅ Utilisateur ajouté !"); } function envoyerWhatsApp(i) { const rec=records.filter(r=>r.appart===currentUser.appart && r.bat===currentUser.bat)[i]; const msg="Salam :\nArrivée: "+rec.date+"\nAppartement: "+rec.appart+"\nImm: "+rec.bat+"\nNombre de personnes: "+rec.personnes.length+"\nRéservation au nom de:\n"+rec.personnes[0].nom+" ("+rec.personnes[0].nom+")\n\nAutres personnes:\ 