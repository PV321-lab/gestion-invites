<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestion des invités</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.hidden { display: none; }
input, select { margin: 5px; padding: 5px; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
#records { max-height: 400px; overflow-y: auto; }
button { padding: 5px 10px; margin: 5px; }
</style>
</head>
<body>

<div id="loginDiv">
<h2>Connexion</h2>
<input type="text" id="username" placeholder="Nom utilisateur">
<select id="role">
<option value="user">Utilisateur</option>
<option value="admin">Admin</option>
</select>
<button onclick="login()">Se connecter</button>
</div>

<div id="mainDiv" class="hidden">
<h2>Enregistrement invité</h2>
<form id="guestForm">
<select id="appartement" required>
<option value="">Appartement</option>
<option value="A1">A1</option>
<option value="A2">A2</option>
<option value="B1">B1</option>
</select>
<select id="batiment" required>
<option value="">Bâtiment</option>
<option value="Bâtiment 1">Bâtiment 1</option>
<option value="Bâtiment 2">Bâtiment 2</option>
</select>
<input type="number" id="nbInvites" placeholder="Nombre d'invités" required>
<input type="text" id="nomPrenom" placeholder="Nom et Prénom" required>
<input type="text" id="idDoc" placeholder="Passeport ou Carte Nationale" required>
<input type="date" id="dateArrivee" required>
<button type="submit">Enregistrer</button>
</form>

<h3>Invités</h3>
<div id="records">
<table>
<thead>
<tr>
<th>Appartement</th>
<th>Bâtiment</th>
<th>Nb Invités</th>
<th>Nom & Prénom</th>
<th>ID</th>
<th>Date Arrivée</th>
<th>QR Code</th>
</tr>
</thead>
<tbody id="recordBody"></tbody>
</table>
</div>

</div>

<script>
let currentUser = '';
let currentRole = '';
let records = {};

function login() {
currentUser = document.getElementById('username').value;
currentRole = document.getElementById('role').value;
if (!currentUser) { alert('Entrez le nom utilisateur'); return; }
if (!records[currentUser]) records[currentUser] = [];
document.getElementById('loginDiv').classList.add('hidden');
document.getElementById('mainDiv').classList.remove('hidden');
renderRecords();
}

document.getElementById('guestForm').addEventListener('submit', function(e){
e.preventDefault();
let appartement = document.getElementById('appartement').value;
let batiment = document.getElementById('batiment').value;
let nbInvites = document.getElementById('nbInvites').value;
let nomPrenom = document.getElementById('nomPrenom').value;
let idDoc = document.getElementById('idDoc').value;
let dateArrivee = document.getElementById('dateArrivee').value;
if(!appartement || !batiment || !nbInvites || !nomPrenom || !idDoc || !dateArrivee){
alert('Tous les champs sont obligatoires'); return;
}
let newRecord = {appartement, batiment, nbInvites, nomPrenom, idDoc, dateArrivee};
records[currentUser].push(newRecord);
renderRecords();
this.reset();
});

function renderRecords() {
let tbody = document.getElementById('recordBody');
tbody.innerHTML = '';
records[currentUser].forEach((r,index)=>{
let tr = document.createElement('tr');
tr.innerHTML = `<td>${r.appartement}</td>
<td>${r.batiment}</td>
<td>${r.nbInvites}</td>
<td>${r.nomPrenom}</td>
<td>${r.idDoc}</td>
<td>${r.dateArrivee}</td>
<td id="qr${index}"></td>`;
tbody.appendChild(tr);
QRCode.toCanvas(document.getElementById(`qr${index}`), JSON.stringify(r), {width: 80});
});
}

// Simulation de 600000 enregistrements pour test
function simulateMassRecords() {
let user = currentUser || 'simuUser';
if(!records[user]) records[user] = [];
for(let i=0;i<600000;i++){
records[user].push({appartement:'A1', batiment:'B1', nbInvites:1, nomPrenom:'Invité '+i, idDoc:'ID'+i, dateArrivee:'2025-08-16'});
}
renderRecords();
}

// Appel pour test
// simulateMassRecords();
</script>

</body>
</html>